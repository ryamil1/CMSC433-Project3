<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<script src="pro3_gui.js"></script>
	<script src="person.js"></script>	
	<script src="caravan.js"></script>
	<script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<link rel="stylesheet" href="interact.css">
</head>
<body>
	<script>
		$('document').ready(function() {
			//Basic cost constants for stores
			const OXEN = 20;
			const CLOTHING = 10;
			const PART = 10;
			const AMMO = 8;
			const FOOD = .2;
			var job = ""
			var travID;  //This cannot be cleaned up.  Variable scoping is critical to event handling
			var weather = "clear";  //Default weather
			var caravan = new Caravan(1);  //Similarly, this needs to be kept here for scoping.
			var item_being_bought = 0;
			var seq_c = 0; //Variable used to track where the game is in a sequence of frames, e.g. the intro.
			//Everything in this area is for testing purposes and should be cleaned, eventually.
			// Draw the animated canvas
			drawCanvas(caravan.location);
			loadData(weather);  
			caravan.makeMember("Potato");
			console.log(caravan.members);
			console.log(caravan.day);
			caravan.goFishing();
			console.log(caravan.food);
			caravan.rest(1);
			console.log(caravan.food);
			caravan.rest(2);
			console.log(caravan.food);
			console.log(caravan.members[0].isAlive());
			console.log("Living check", caravan.checkForDead());
			caravan.pace = 1;
			//Function to make oxen walk and stuff happen while traveling.
			function travel(){
				//Repeat an arbitrary number of times...
				travID = setInterval ( () => {
					loadInteract(getWeather());  
					if (caravan.checkForDead() == -1) {
						console.log("Here Lies Potato");
						clearInterval(travID);
						drawGrave("Potato");
						return -1;
					}
					caravan.getEvent();  //critical
					console.log("Rolling along", caravan.distance);
					console.log("Living check", caravan.checkForDead());
					console.log("Next landmark:", caravan.nextLandmark);
					loadInteract(getWeather());  //testing
					loadData(getWeather());  //critical
					if(caravan.nextLandmark == "flag1"){ //testing
						caravan.goToGreenRiver();
					}
					else if(caravan.nextLandmark == "flag2"){ //also testing
						caravan.goToTheDalles();
					}
					//this block is critical
					dist = caravan.target_distance - caravan.distance;
					console.log("Distance to Next Landmark: ", dist);
					animateWagon(caravan.pace);
					if (dist <= 60) {
						animateLandmark(dist, caravan.pace, caravan.nextLandmark);
					}
				}, 2000); //every 2 seconds.
			}
			//Convert pace into words.
			function getPace(){
				if(caravan.pace == 1){
					return "steady";
				} else if(caravan.pace == 1.5){
					return "strenuous";
				} else {
					return "grueling";
				}
			}
			//Convert rations into words.
			function getRations(){
				if(caravan.rations == 3){
					return "filling";
				} else if(caravan.rations == 2){
					return "meager";
				} else{
					return "bare bones";
				}
			}
			//Function to handle buying things at forts.  Pass it the item number and quantity and
			//it will do the rest
			function buyThings(item, number){
				console.log("Buying Things:", item, number)
				var fort_cost = 1;
				var item_cost = 0;
				if(caravan.fort){
					fort_cost += (caravan.fort - 1) / 4; 
				}

				if(item == 1){
					item_cost = OXEN;
					if(caravan.oxen + number > 20){
						return -1;
					}
				} else if(item == 2) {
					item_cost = CLOTHING;
				} else if(item == 3) {
					item_cost = AMMO;
				} else if(item == 4) {
					item_cost = PART;
				} else if(item == 5) {
					item_cost = PART;
				} else if(item == 6) {
					item_cost = PART;
				} else if(item == 7) {
					item_cost = FOOD;
					if(caravan.food + number > 2000){
						return -1;
					}
				}

				if(item_cost * number * fort_cost > caravan.money){
					return false;
				}

				caravan.money -= item_cost * number * fort_cost;

				if(item == 1){
					caravan.oxen += number;
				} else if(item == 2) {
					caravan.clothes += number;
				} else if(item == 3) {
					caravan.ammo += number * 20;
				} else if(item == 4) {
					caravan.wheel += number;
				} else if(item == 5) {
					caravan.tongue += number;
				} else if(item == 6) {
					caravan.axle += number;
				} else if(item == 7) {
					caravan.food += number;
				}

				return true;
			}

			function getCost(item){
				if(item == 1){
					return OXEN * (1 + (caravan.fort - 1) / 4);
				} else if(item == 2) {
					return CLOTHING * (1 + (caravan.fort - 1) / 4);
				} else if(item == 3) {
					return AMMO * (1 + (caravan.fort - 1) / 4);
				} else if(item == 4) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 5) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 6) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 7) {
					return FOOD * (1 + (caravan.fort - 1) / 4);
				}
			}

			//Function to dynamically load text into store frame.
			function loadStore(){
				var str = "You may buy:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Oxen<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Clothing<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Ammunition<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Wagon wheels<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Wagon axles<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Wagon tongues<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Food<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Leave store";
				if(caravan.fort == 1){
					str += "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9. Advice";
				}
				$('.frame-store').find('#items').html(str)

				$('.frame-store').find('#costs').html(
				getCost(1).toFixed(2) + "<br>" +
				getCost(2).toFixed(2) + "<br>" +
				getCost(3).toFixed(2) + "<br>" +
				getCost(4).toFixed(2) + "<br>" +
				getCost(5).toFixed(2) + "<br>" +
				getCost(6).toFixed(2) + "<br>" +
				getCost(7).toFixed(2) + "<br>"
				);

				$('.frame-store').find('#money').html(
					"You have $" + caravan.money.toFixed(2) + " to spend.<br>Which number?" 
				);
			}

			//Translate the date from number to a date.
			function getDate(){
				if(caravan.day > 273) {
					//game over
				}
				if(caravan.day <= 30){
					return "April " + caravan.day + ", 1848"
				} else if(caravan.day <= 61){
					return "May " + (caravan.day - 30) + ", 1848"
				} else if(caravan.day <= 91){
					return "June " + (caravan.day - 61) + ", 1848"
				} else if(caravan.day <= 122){
					return "July " + (caravan.day - 91) + ", 1848"
				} else if(caravan.day <= 152){
					return "August " + (caravan.day - 122) + ", 1848"
				} else if(caravan.day <= 183){
					return "September " + (caravan.day - 152) + ", 1848"
				} else if(caravan.day <= 213){
					return "October " + (caravan.day - 183) + ", 1848"
				} else if(caravan.day <= 244){
					return "November " + (caravan.day - 213) + ", 1848"
				} else if(caravan.day <= 274){
					return "December " + (caravan.day - 244) + ", 1848"
				}
			}
			//Figure out what today's weather is.
			function getWeather(){
				value = Math.floor(Math.random() * 100);
				if(this.day < 60 || this.day > 210){
					value -= 10;
				} 
				else if(this.day > 120 && this.day < 180){
					value += 10;
				}
				if(value < 2) {
					return weather = "cold";
				}
				else if(value < 32){
					return weather = "cool";
				}
				else if(value < 46){
					return weather = "rainy";
				}
				else if(value < 49){
					return weather = "very rainy";
				}
				else if(value < 71){
					return weather = "warm";
				}
				else if(value < 97){
					return weather = "hot";
				}
				else{
					return weather = "very hot";
				}
			}
			//Load data into the interact page.
			function loadInteract(weather){
				$('.frame-interact').find('.header').html(
					"<br>" + getDate() + "<br>"
				);
				$('.frame-interact').find('.status').html(
					"&nbsp;&nbsp;Weather: " + weather + "<br>&nbsp;&nbsp;Health: " + caravan.partyHealth() + "<br>&nbsp;&nbsp;Pace: " + getPace() + "<br>&nbsp;&nbsp;Rations: " + getRations() + "<br>"
				);
			}
			//Load data into the ui of the travel page.
			function loadData(weather){
				drawEnvironment(weather, caravan.location);
				$('.frame-travel').find('.data').html(
					"" + getDate() + "<br>" + weather + "<br>" + caravan.partyHealth() + "<br>" + caravan.food + "<br>" + (caravan.target_distance - caravan.distance) + "<br>" + caravan.distance
				);
			}
	
			function jobAndTimeSwap(){
				$('.frame-choice').hide();
				$('.frame-names').show();
				$('.frame-choice').find('#job').hide();
				$('.frame-choice').find('#time').show();
			}
			//This function is going to get massive, I think.  
			//Handles key press events.
			$(document).keydown(function(){
				key_code = event.keyCode;
				console.log(key_code)

				//Find the visible frame.
				var activeFrame = $('.frame:visible').attr('class');
				//Handle based on active frame.
				if(activeFrame == "frame frame-travel") {
					//If key is enter, stop the game.
					if(key_code==13) {
						clearInterval(travID);
						$('.frame-travel').hide();
						$('.frame-interact').show();
					}
				}
				//Handle interactions when pausing during the game.
				else if(activeFrame == "frame frame-interact") {
					if(key_code==32) {
						clearInterval(travID); //This prevents warp speed.
						$('.frame-travel').show();
						$('.frame-interact').hide();
						travel();
					//If the key is 1-8, do the thing.
					} else if (key_code >= 49 && key_code <= 55){

					}//If the key is 9, this needs to be validated.
					else if(key_code == 57){

					} //If the user has already provided an input, process it...
					else if(key_code == 13){

					}
				}
				//Handle interactions on the hall of fame page.
				else if(activeFrame == "frame frame-hall"){
					//If the game is over, let them enter letters.
					if(0){}
					else if(key_code==32){
						$('.frame-hall').hide();
						$('.frame-intro').show();
					}
				}
				//Handle interactions on the front page.
				else if(activeFrame == "frame frame-intro"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-intro').find('#response').html(event.key);
					}
					else if(key_code == 13){
						var cur = $('.frame-intro').find('#response').html();
						if(cur == 1){
							$('.frame-choice').show();
							$('.frame-intro').hide();
						} else if (cur == 2){
							$('.frame-intro').find('#response').html(" ");
							$.get( "getTen.php", function(data){
								pairs = data.split("\n");
								for(var i = 0; i < 10; i++){
									player = pairs[i].split(',');
									$('.frame-hall').find('#players').append(player[0] + "<br>");
									$('.frame-hall').find('#scores').append(player[1] + "<br>");
								}
								console.log(pairs);
								$('.frame-hall').show();
								$('.frame-intro').hide();
							});
						}
					}
				}
				//Multi purpose frame for the beginning of the game
				else if(activeFrame == "frame frame-choice"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-choice').find('#choice_res').html(event.key);
					} else if (job != "" && key_code >= 52 && key_code <= 54){
						$('.frame-choice').find('#choice_res').html(event.key);
					}
					else if(key_code == 13 && job == ""){
						var cur = $('.frame-choice').find('#choice_res').html();
						if (cur == 1){
							job = "Banker";
							jobAndTimeSwap();
						} else if (cur == 2){
							job = "Carpenter";
							jobAndTimeSwap();
						} else if (cur == 3){
							job = "Farmer";
							jobAndTimeSwap();
						}
						var cur = $('.frame-choice').find('#choice_res').html(" ");
					} else if(key_code == 13){
						var cur = $('.frame-choice').find('#choice_res').html();
						if (cur == 1){
							caravan = new Caravan (1,job);
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 2){
							caravan = new Caravan (31,job);
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (62,job);
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (92,job);
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (123,job);
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						}
						var cur = $('.frame-choice').find('#choice_res').html(" ");
					}
				}
				//Handle buying things from the store.
				else if (activeFrame == "frame frame-store"){
					if(seq_c == 0 && key_code >= 49 && key_code <= 56){
						$('.frame-store').find('#store-choice').html(event.key);
					}
					else if(seq_c == 0 && key_code == 13) {
						if($('.frame-store').find('#store-choice').html() == 8){
							item_being_bought = 0;
							$('.frame-store').find('#store-choice').html("");
							$('.frame-store').hide();
							$('.frame-interact').show();
						} else {
							item_being_bought = $('.frame-store').find('#store-choice').html()
							console.log("Item", item_being_bought);
							$('.frame-store').find('#s_num').show();
							seq_c = 1;
						}
					} else if (key_code >= 48 && key_code <= 57){
						$('.frame-store').find('#store-choice2').append(event.key);
					} else if (key_code == 13){
						buyThings(item_being_bought, $('.frame-store').find('#store-choice2').html());
						$('.frame-store').find('#store-choice').html("");
						$('.frame-store').find('#store-choice2').html("");
						$('.frame-store').find('#s_num').hide();
						loadStore();
						seq_c = 0;
					}
				}
				//Manage naming the party
				else if (activeFrame == "frame frame-names") {
					if(seq_c < 1 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res1').html().length < 30){
							$('.frame-names').find('#names_res1').append(event.key);
							seq_c = .5;
						}
					} else if(seq_c == .5 && key_code == 13){
						seq_c = 1;
					} else 	if(seq_c < 2 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res2').html().length < 30){
							$('.frame-names').find('#names_res2').append(event.key);
							seq_c = 1.5;
						}
					} else if(seq_c == 1.5 && key_code == 13){
						seq_c = 2;
					} else 	if(seq_c < 3 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res3').html().length < 30){
							$('.frame-names').find('#names_res3').append(event.key);
							seq_c = 2.5;
						}
					} else if(seq_c == 2.5 && key_code == 13){
						seq_c = 3;
					} else 	if(seq_c < 4 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res4').html().length < 30){
							$('.frame-names').find('#names_res4').append(event.key);
							seq_c = 3.5;
						}
					} else if(seq_c == 3.5 && key_code == 13){
						seq_c = 4;
					} else if(seq_c < 5 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res5').html().length < 30){
							$('.frame-names').find('#names_res5').append(event.key);
							seq_c = 4.5;
						}
					} else if(seq_c == 4.5 && key_code == 13){
						seq_c = 5;
						$('.frame-names').find('#confirm').show();
					} else if(seq_c < 6 && (key_code == 78 || key_code ==89)) {
						seq_c = 5.5;
						$('.frame-names').find('#names_res6').html(event.key);
					} else if(seq_c == 5.5 && key_code == 13){
						if($('.frame-names').find('#names_res6').html().toLowerCase() == "n"){
							$('.frame-names').find('#names_res1').html("");
							$('.frame-names').find('#names_res2').html("");
							$('.frame-names').find('#names_res3').html("");
							$('.frame-names').find('#names_res4').html("");
							$('.frame-names').find('#names_res5').html("");
							$('.frame-names').find('#names_res6').html("");
							seq_c = 0;
							$('.frame-names').find('#confirm').hide();
						} else{
							caravan.makeMember($('.frame-names').find('#names_res1').html());
							caravan.makeMember($('.frame-names').find('#names_res2').html());
							caravan.makeMember($('.frame-names').find('#names_res3').html());
							caravan.makeMember($('.frame-names').find('#names_res4').html());
							caravan.makeMember($('.frame-names').find('#names_res5').html());
							$('.frame-names').hide();
							$('.frame-choice').show();
							seq_c = 0;
						}
					}
				}

			});
		});
	</script>
	<div class="border"></div>
	<div class="frame frame-travel" style="display: none;">
		<img id="wagon" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<img id="location" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<canvas id="myCanvas" width="600" height="190" style="border:0px solid black;"></canvas>
		<p id="info" class="size_up" style="font-family:georgia">
				Press enter to size up the situation.
		<div id="data" class="data-frame"><p class="labels" style="font-family:georgia">
				Date :<br>
				Weather :<br>
				Health :<br>
				Food :<br>
				Next landmark :<br>
				Miles traveled :<br>
		</p>
		<p class="data" style="font-family:georgia">
			
		</p></div>
	</div>
	<div class="frame frame-interact" style="display: none;">
		<p class="header" style="font-family:georgia">
		Independence<br>
		Date<br>
		</p>
		<p class="status" style="font-family:georgia">
			Weather: getweather<br>
			Health: gethealth<br>
			Pace: getpace<br>
			Rations: getrations<br>
		</p>
		<p class="options" style="font-family:georgia">
			&nbsp;&nbsp;You may: <br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Continue on trail<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Check supplies<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Look at map<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Change pace<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Change food rations<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Stop to rest<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Attempt to trade<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Go fishing<br><br><br>

			&nbsp;&nbsp;What is your choice?
		</p>
		<p class="response" style="font-family:georgia">
		</p>
	</div>
	<div class="frame frame-image" style="display: none;">
	</div>
	<div class="frame frame-choice" style="display: none;">
		<p id="job" style="font-family:georgia">
			Many kinds of people made the trip to Oregon <br><br>

			&nbsp;&nbsp;You may:<br><br>
		
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Be a banker from Boston. <br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Be a carpenter from Ohio. <br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Be a farmer from Illinois.
		</p>
		<p id="choice_choice" style="font-family:georgia">What is your choice?</p>
		<p id="time" style="font-family:georgia;display:none;"> It is 1848. Your jumping off place for Oregon is Independence, Missouri.  You must decide which month to leave Independence. <br>
			<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. March<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. April<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. May<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. June<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. July
		</p>
		<p id="choice_res" style="font-family:georgia"></p>
	</div>
	<div class="frame frame-hall" style="display:none;">
		<p id="columns" style="font-family:georgia"><u>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Scores</u>
		</p>
		<p id="players" style="font-family:georgia">
		</p>
		<p id="scores" style="font-family:georgia">
		</p>
	</div>
	<div class="frame frame-intro">
		<p class="title" style="font-family:georgia">
			The Oregon Trail
		</h1>
		<p id="options" style="font-family:georgia">
			&nbsp;&nbsp;You may:<br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Travel the trail<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. See the top ten<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. New player advice<br>

			<br><br>&nbsp;&nbsp;What is your choice?
		</p>
		<p id="response" style="font-family:georgia"></p>
	</div>
	<div class="frame frame-store" style="font-family:georgia;display:none;">
		<p id="items">
		</p>
		<p id="costs">
		</p>
		<p id="fluff">
			per ox<br>
			per set<br>
			per box<br>
			per wheel<br>
			per axle<br>
			per tongue<br>
			per pound<br>
		</p>
		<p id="money">
		</p>
		<p id="store-choice">
		</p>
		<p id="s_num" style="display:none;">
			How many?
		</p>
		<p id="store-choice2">
		</p>
	</div>
	<div class="frame frame-names" style="font-family:georgia;display:none;">
		<p id="question">
		What are the names of the members of your party?
		</p>
		<p id="members">
			&nbsp;1. <br>
			&nbsp;2. <br> 
			&nbsp;3. <br> 
			&nbsp;4. <br> 
			&nbsp;5. <br>
		</p>
		<p id="confirm" style="display:none;">&nbsp;&nbsp;&nbsp;&nbsp;Are these the names you want?</p>
		<p id="names_res1">
		</p>
		<p id="names_res2">
		</p>
		<p id="names_res3">
		</p>
		<p id="names_res4">
		</p>
		<p id="names_res5">
		</p>
		<p id="names_res6">
		</p>
		
	</div>
</body>
</html>
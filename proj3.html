<!DOCTYPE html>
<!-- Ryan Miller and Kyle Castle -->
<html>
<head>
	<meta charset=utf-8 />
	<script src="pro3_gui.js"></script>
	<script src="person.js"></script>	
	<script src="caravan.js"></script>
	<script src="rivercross.js"></script>
	<script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="interact.css">
</head>
<body>
	<script>
		$('document').ready(function() {
			//Basic cost constants for stores
			const OXEN = 20;
			const CLOTHING = 10;
			const PART = 10;
			const AMMO = 8;
			const FOOD = .2;
			var job = ""
			var travID;  //This cannot be cleaned up.  Variable scoping is critical to event handling
			var weather = "clear";  //Default weather
			var caravan = new Caravan(1);  //Similarly, this needs to be kept here for scoping.
			var item_being_bought = 0;
			var eventID = "";
			var first;
			var riverDeep = 0;
			var riverWidth = 0;
			var success = 0;
			var score = 0;
			loadEndgame();
			var seq_c = 0;//Variable used to track where the game is in a sequence of frames, e.g. the intro.
			//Everything in this area is for testing purposes and should be cleaned, eventually.
			// Draw the animated canvas
			drawCanvas(caravan.location);
			loadData(weather);  
			caravan.pace = 1;
			//Function to make oxen walk and stuff happen while traveling.
			function travel(){
				console.log(caravan.money)
				//Repeat an arbitrary number of times...
				travID = setInterval ( () => {
					var isLocked = caravan.eventLocked;
					loadInteract(getWeather()); 
					//If checkForDead returns a non-falsey value, keep calling it.
					dead = caravan.checkForDead()
					while(dead){
						if (dead == -1) { //game over
							console.log("Here Lies Potato");
							clearInterval(travID);
							$('.frame:visible').find('.event').hide();
							drawGrave(first);
							return -1;
						} else { //only one death
							if(eventID == ""){
								eventID = (dead + " has died.<br>");
							} else{
							eventID += (dead + " has died.<br>");
							}
							dead = caravan.checkForDead();
						}
					}

					//Get a random event.
					eventID += caravan.getEvent();  //critical
					if(eventID != ""){
						console.log(">>>", eventID);
						makeEvent(eventID);
					}

					console.log("Rolling along", caravan.distance);
					console.log("Next landmark:", caravan.nextLandmark);
					loadInteract(getWeather());  //testing
					//Update the page
					loadData(getWeather());  //critical

					//Animate the wagon moving.
					dist = caravan.target_distance - caravan.distance;
					console.log("Distance to Next Landmark: ", dist);
					if(!isLocked){
						animateWagon(caravan.pace);
						if (dist <= 60) {
							animateLandmark(dist, caravan.pace, caravan.nextLandmark);
						}
					}

					//Handle landmarks
					landmark = caravan.hitLandmark;
					if(landmark){
						handleLandmark(landmark, isLocked);
					}

					cleanEvents(isLocked);


					
				}, 2000); //every 2 seconds.
			}

			function cleanEvents(isLocked){
				//If there was an event...
				if(eventID){
					//clear it.
					eventID = "";
					//If the event did not lock the travel, terminate travel.
					if(!caravan.eventLocked){
						clearInterval(travID);
					}
				//If the travel was locked for 1 day at the start of the function,
				//the event has just finished and travel() needs to stop.
				} else if(isLocked == 1){
					clearInterval(travID);						
				}
			}

			//Make an event pop-up.
			function makeEvent(str){
				console.log(str);
				console.log(">>>", $('.frame:visible'), str);
				$('.frame:visible').find('.event').html(str);
				$('.frame:visible').find('.event').show();
			}

			function isRiver(){
				if(caravan.hitLandmark == "Kansas River Crossing" || caravan.hitLandmark == "Big Blue River Crossing" || caravan.hitLandmark == "Green River" || caravan.hitLandmark == "Snake River Crossing"){
					return true;
				}
				return false;
			}

			//Convert pace into words.
			function getPace(){
				if(caravan.pace == 1){
					return "steady";
				} else if(caravan.pace == 1.5){
					return "strenuous";
				} else {
					return "grueling";
				}
			}

			//Convert rations into words.
			function getRations(){
				if(caravan.rations == 3){
					return "filling";
				} else if(caravan.rations == 2){
					return "meager";
				} else{
					return "bare bones";
				}
			}
			//Function to handle buying things at forts.  Pass it the item number and quantity and
			//it will do the rest
			function buyThings(item, number){
				number = parseInt(number);
				console.log("Buying Things:", item, number)
				var fort_cost = 1;
				var item_cost = 0;
				console.log("Current fort: ", caravan.fort);
				if(caravan.fort){
					fort_cost += (caravan.fort - 1) / 4; 
				}

				if(item == 1){
					item_cost = OXEN;
					if(caravan.oxen + number > 20){
						console.log("Too many oxen.")
						return -1;
					}
				} else if(item == 2) {
					item_cost = CLOTHING;
				} else if(item == 3) {
					item_cost = AMMO;
				} else if(item == 4) {
					item_cost = PART;
				} else if(item == 5) {
					item_cost = PART;
				} else if(item == 6) {
					item_cost = PART;
				} else if(item == 7) {
					item_cost = FOOD;
					if(caravan.food + number > 2000){
						console.log("Too much food.", caravan.food, number)
						return -1;
					}
				}

				console.log("Item cost:", item_cost, "Fort cost:", fort_cost);
				if(item_cost * number * fort_cost > caravan.money){
					return false;
				}

				caravan.money -= item_cost * number * fort_cost;

				if(item == 1){
					console.log("Oxen:", caravan.oxen, "number:", number);
					caravan.oxen += parseInt(number);
				} else if(item == 2) {
					caravan.clothes += parseInt(number);
				} else if(item == 3) {
					caravan.ammo += parseInt(number) * 20;
				} else if(item == 4) {
					caravan.wheel += parseInt(number);
				} else if(item == 5) {
					caravan.tongue += parseInt(number);
				} else if(item == 6) {
					caravan.axle += parseInt(number);
				} else if(item == 7) {
					caravan.food += parseInt(number);
				}

				return true;
			}

			//Function to help calculate store prices to populate that menu
			function getCost(item){
				if(item == 1){
					return OXEN * (1 + (caravan.fort - 1) / 4);
				} else if(item == 2) {
					return CLOTHING * (1 + (caravan.fort - 1) / 4);
				} else if(item == 3) {
					return AMMO * (1 + (caravan.fort - 1) / 4);
				} else if(item == 4) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 5) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 6) {
					return PART * (1 + (caravan.fort - 1) / 4);
				} else if(item == 7) {
					return FOOD * (1 + (caravan.fort - 1) / 4);
				}
			}

			//Function to dynamically load text into store frame.
			function loadStore(){
				var str = "You may buy:<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Oxen<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Clothing<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Ammunition<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Wagon wheels<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Wagon axles<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Wagon tongues<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Food<br>" +
					"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Leave store";
				if(caravan.fort == 1){
					str += "<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9. Advice";
				}
				$('.frame-store').find('#items').html(str)

				$('.frame-store').find('#costs').html(
				getCost(1).toFixed(2) + "<br>" +
				getCost(2).toFixed(2) + "<br>" +
				getCost(3).toFixed(2) + "<br>" +
				getCost(4).toFixed(2) + "<br>" +
				getCost(5).toFixed(2) + "<br>" +
				getCost(6).toFixed(2) + "<br>" +
				getCost(7).toFixed(2) + "<br>"
				);

				$('.frame-store').find('#money').html(
					"You have $" + caravan.money.toFixed(2) + " to spend.<br>Which number?" 
				);
			}

			function handleLandmark(landmark, isLocked){
				clearInterval(travID);
				loadLandmark(landmark);
				cleanEvents(isLocked);
			}

			function loadLandmark(landmark){
				var str = "You are now at the " + landmark + ". Would you like to look around?<br>"
				$('.frame-travel').find('#landmark').html(str);
				$('.frame-travel').find('#landmark').show();
			}

			//Translate the date from number to a date.
			function getDate(){
				if(caravan.day > 273) {
					//game over
				}
				if(caravan.day <= 30){
					return "April " + caravan.day + ", 1848"
				} else if(caravan.day <= 61){
					return "May " + (caravan.day - 30) + ", 1848"
				} else if(caravan.day <= 91){
					return "June " + (caravan.day - 61) + ", 1848"
				} else if(caravan.day <= 122){
					return "July " + (caravan.day - 91) + ", 1848"
				} else if(caravan.day <= 152){
					return "August " + (caravan.day - 122) + ", 1848"
				} else if(caravan.day <= 183){
					return "September " + (caravan.day - 152) + ", 1848"
				} else if(caravan.day <= 213){
					return "October " + (caravan.day - 183) + ", 1848"
				} else if(caravan.day <= 244){
					return "November " + (caravan.day - 213) + ", 1848"
				} else if(caravan.day <= 274){
					return "December " + (caravan.day - 244) + ", 1848"
				}
			}
			//Figure out what today's weather is.
			function getWeather(){
				value = Math.floor(Math.random() * 100);
				if(this.day < 60 || this.day > 210){
					value -= 10;
				} 
				else if(this.day > 120 && this.day < 180){
					value += 10;
				}
				if(value < 2) {
					return weather = "cold";
				}
				else if(value < 32){
					return weather = "cool";
				}
				else if(value < 46){
					return weather = "rainy";
				}
				else if(value < 49){
					return weather = "very rainy";
				}
				else if(value < 71){
					return weather = "warm";
				}
				else if(value < 97){
					return weather = "hot";
				}
				else{
					return weather = "very hot";
				}
			}

			//Load data into the interact page.
			function loadInteract(weather){
				$('.frame-interact').find('.header').html(
					"<br>" + getDate() + "<br>"
				);
				$('.frame-interact').find('.status').html(
					"&nbsp;&nbsp;Weather: " + weather + "<br>&nbsp;&nbsp;Health: " + caravan.partyHealth() + "<br>&nbsp;&nbsp;Pace: " + getPace() + "<br>&nbsp;&nbsp;Rations: " + getRations() + "<br>"
				);

				var str = 	"&nbsp;&nbsp;You may: <br><br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Continue on trail<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Check supplies<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Look at map<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Change pace<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Change food rations<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Stop to rest<br>" +
							"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Attempt to trade<br>" 
				if(caravan.hitLandmark && !caravan.fort){
					str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Talk to people<br><br><br>"
				} else if (caravan.fort){
					str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Talk to people<br>"
					str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9. Buy supplies<br><br>" 
				} else {
					str += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Go fishing<br><br><br>"
				}

				str += "What is your choice?";

				$('.frame-interact').find('.options').html(str);

			}
			//Load data into the ui of the travel page.
			function loadData(weather){
				drawEnvironment(weather, caravan.location);
				$('.frame-travel').find('.data').html(
					"" + getDate() + "<br>" + weather + "<br>" + caravan.partyHealth() + "<br>" + caravan.food + "<br>" + (caravan.target_distance - caravan.distance) + "<br>" + caravan.distance
				);
			}
	
			function loadMPaths(){
				console.log(caravan.nextLandmark);
				var str = "The trail divides here. You may:<br><br>";
				if(caravan.nextLandmark == "flag1"){
					str += "1. head for Green River crossing<br>2.head for Fort Bridger";
					str += "<br><br>What is your choice?";
					$('#mpaths_text').html(str).show();
				} else if(caravan.nextLandmark == "flag2"){
					str += "1. head for Fort Walla Walla<br>2.head for The Dalles";
					str += "<br><br>What is your choice?";
					$('#mpaths_text').html(str).show();
				} else if(caravan.nextLandmark == "flag3"){
					str += "1. head for the Barlow Toll Road ($5)<br>2.go down the rapids";
					str += "<br><br>What is your choice?";
					$('#mpaths_text').html(str).show();
				} else if(caravan.nextLandmark == "flag4"){
					$('.frame-travel').hide();
					$('.frame-endgame').hide();
				} else{
					return 0;
				}
				return 1;
			}

			function processMPaths(choice){
				if(caravan.nextLandmark == "flag1"){
					$('#mpaths_text').html("").hide();
					if(choice == 1){
						caravan.goToGreenRiver();
					} else{
						caravan.goToFortBridger()
					}
				} else if(caravan.nextLandmark == "flag2"){
					$('#mpaths_text').html("").hide();
					if(choice == 1){
						caravan.goToFortWallaWalla();
					} else{
						caravan.goToTheDalles()
					}
				} else if(caravan.nextLandmark == "flag3"){
					$('#mpaths_text').html("").hide();
					if(choice == 1 && caravan.money > 5){
						caravan.money -= 5;
						caravan.goToBarlowTollRoad();
					} else {
						clearInterval(travID);
						$('.frame-travel').hide();
						toTheRapids();
						return 1;
					} 
				} else{
					return 0;
				}
				travel();
			}

			function toTheRapids(){
				$('.frame-travel').hide();
				$('.frame-unimplemented').show();
			}

			function jobAndTimeSwap(){
				$('.frame-choice').hide();
				$('.frame-names').show();
				$('.frame-choice').find('#job').hide();
				$('.frame-choice').find('#time').show();
			}

			function loadPace(){
				$('.frame-pace').find('#top').html(
					"Change pace<br>(currently " + getPace() + ")"
				);
			}
			
			function loadRations(){
				$('.frame-rations').find('#top').html(
					"Change food rations<br>(currently " + getRations() + ")"
				);
			}
		
			function loadSupplies(){
				$('.frame-supplies').find('#quantities').html(
					caravan.oxen + "<br>" + caravan.clothes + "<br>" + caravan.ammo + "<br>" + caravan.wheel + "<br>" + caravan.axle + "<br>" +
					caravan.tongue + "<br>" + caravan.food + "<br>$" + caravan.money.toFixed(2)
				);
			}

			function loadRiverDesc(){
				$('#river_header').html(
					caravan.hitLandmark + "<br>" + getDate()
				).show();
				riverDeep = Math.floor(Math.random() * 10)
				riverWidth = Math.floor(Math.random() * 300)
				$('.frame-river').find('#description').html(
					"You must cross the river in order to continue.  The river at this point is " + riverWidth + " feet across and " + riverDeep + " feet deep in the middle."
				).show();
				
			}

			function loadRiverChoice(){
				var str = 	"Weather: " + weather + "<br>" +
							"River width: " + riverWidth + "<br>" +
							"River depth: " + riverDeep + "<br>" +
							"<br>You may:<br><br>1. attempt to ford the river<br>2. caulk the wagon and float it across";

				if(caravan.hitLandmark == "Kansas River Crossing" || caravan.hitLandmark == "Green River"){
					str += "<br>3. pay for a ferry ($5, may have to wait)";
				} else if (caravan.hitLandmark == "Snake River Crossing"){
					str += "<br>3. look for a Shoshone guide (trade 2 clothes)";
				} else {
					str += "<br>";
				}

				str += "<br><br>What is your choice?"

				$('.frame-river').find('#choice_text').html(str).show();
			}

			function resetCaravan(){
				car_mem = caravan.members;
				caravan = new Caravan(caravan.day, caravan.job);
				caravan.members = car_mem;
			}

			function loadEndgame(){
				parts_count = caravan.tongue+caravan.wheel+caravan.axle
				$('.frame-endgame').find('#end_items').html(
					caravan.members.length + " person in " + caravan.partyHealth() + "<br>" +
					"1 wagon<br>" + caravan.oxen + " oxen<br>" + parts_count + " caravan parts<br>"+
					caravan.clothes + " sets of clothes<br>" + caravan.ammo + " bullets<br>" + caravan.food + " pounds of food<br>" +
					" $" + caravan.money + " cash"
				);
				var health_mult = 0;
				if(caravan.partyHealth == "very poor"){
					health_mult = 200;
				} else if(caravan.partyHealth == "poor") {
					health_mult = 300;
				} else if(caravan.partyHealth == "fair"){
					health_mult = 400;
				} else {
					health_mult = 500;
				}
				$('.frame-endgame').find('#end_data').html(
					caravan.members.length * health_mult + "<br>" + "50<br>" + caravan.oxen * 4 + "<br>" + parts_count * 2 + "<br>"
					+ caravan.clothes * 2 + "<br>" + caravan.ammo / 50 + "<br>" + caravan.food / 25 + "<br>" + caravan.money / 5
				);
				score = caravan.members.length * health_mult + caravan.oxen * 4 + 50 + parts_count * 2 + caravan.clothes * 2 + caravan.ammo / 50 + caravan.food / 25 + caravan.money / 5;
				$('.frame-endgame').find('#score').html(
					score
				);
			}

			//In an ideal world, this wouldn't.  I hope it doesn't break.
			//Handles key press events.
			$(document).keydown(function(){
				key_code = event.keyCode;
				console.log(key_code)

				//Find the visible frame.
				var activeFrame = $('.frame:visible').attr('class');
				//Handle based on active frame.
				if(activeFrame == "frame frame-travel") {
					if($('.event:visible').length){
						//If the event pop-up is visible...
						if(caravan.eventLocked == 0 && key_code == 13){
							$('.frame-travel').find('.event').hide();
							clearInterval(travID);
							travel();
						} else if(caravan.eventLocked == 0 && key_code == 32){
							$('.frame-travel').find('.event').hide();
							$('.frame-travel').hide();
							$('.frame-interact').show();
						}
					//If the landmark prompt is up...
					} else if($('#landmark:visible').length){
						if(key_code == 89){
							$('#landmark_res').html("y");
							seq_c = 1;
						} else if (key_code == 78){
							$('#landmark_res').html("n");
							seq_c = 1
						} else if (seq_c == 1 && key_code == 13){
							if($('#landmark_res').html() == "n"){
								seq_c = 0;
								$('#landmark_res').html("");
								$('#landmark').hide();
								if(isRiver()){
									$('.frame-travel').hide();
									loadRiverDesc();
									$('.frame-river').show();
								} else {
									var split = loadMPaths();
									clearInterval(travID);
									if(!split){
										travel();
									}
								}
							} else if ($('#landmark_res').html() == "y"){
								seq_c = 0;
								$('#landmark_res').html("");
								$('#landmark').hide();
								$('.frame-travel').hide();
								showLandmark(caravan.hitLandmark);
								$('.frame-landmark').show();
							}
						} 
					} else if($('#mpaths_text:visible').length){
						if(key_code >= 49 && key_code <= 50){
							$('.frame-travel').find('#mpaths_res').html(event.key);
							seq_c = 10;
						} else if (seq_c == 10 && key_code == 13){
							seq_c = 0;
							var stop = processMPaths(parseInt($('.frame-travel').find('#mpaths_res').html()));
							clearInterval(travID);
							if(!stop){
								travel();
							}
						}
					} else if(key_code==13) {
						//If key is enter, stop the game.
						clearInterval(travID);
						$('.frame-travel').hide();
						$('.frame-interact').show();
					}
				}
				//Handle interactions when pausing during the game.
				else if(activeFrame == "frame frame-interact") {
					if (key_code >= 49 && key_code <= 56){
						if(seq_c == 1){
							$('.frame-interact').find('#rest_res').html(event.key);
							seq_c = 2;
						} else if (seq_c == 0){
							$('.frame-interact').find('.response').html(event.key);
						}
					}//If the key is 9, this needs to be validated.
					else if(key_code == 57 && caravan.fort){
						$('.frame-interact').find('.response').html(event.key);
					} //If the user has already provided an input, process it...
					else if(key_code == 13){
						var num = $('.frame-interact').find('.response').html();
						if (seq_c == 2){
							seq_c = 0;
							if 	($('.frame-interact').find('#rest_res').html() != 0){
								for(var i = 1; i <= $('.frame-interact').find('#rest_res').html(); i++){
									caravan.rest(i);
									getWeather();
									loadInteract(weather);
									dead = caravan.checkForDead();
									while(dead){
										if (dead == -1) { //game over
											console.log("Here Lies Potato");
											clearInterval(travID);
											$('.frame:visible').find('.event').hide();
											drawGrave(first);
											return -1;
										} else { //only one death
											if(eventID == ""){
												eventID = (dead + " has died.<br>");
											} else{
											eventID += (dead + " has died.<br>");
											}
											dead = caravan.checkForDead();
										}
									}
								}
							}
							$('.frame-interact').find('#rest_res').html("")
							$('.frame-interact').find('.response').html("")
							$('.frame-interact').find('#rest').hide();
						} else if (seq_c == 3){
							seq_c = 0;
							$('.frame-interact').find('#alert').hide();
						}
						else if(num == 1){
							seq_c = 0;
							$('.frame-interact').find('.response').html("");
							if(isRiver()){
								$('.frame-interact').hide();
								loadRiverDesc();
								$('.frame-river').show();
							} else {
								var split = loadMPaths();
								loadData(weather);
								clearInterval(travID); //This prevents warp speed.
								$('.frame-travel').show();
								$('.frame-interact').hide();
								if(!split){
									travel(); 
								}
							}
						} else if(num == 2){
							seq_c = 0;
							loadSupplies();
							$('.frame-interact').find('.response').html("");
							$('.frame-interact').hide();
							$('.frame-supplies').show();
						} else if(num == 4){
							seq_c = 0;
							loadPace();
							$('.frame-interact').find('.response').html("");
							$('.frame-interact').hide();
							$('.frame-pace').show();
						} else if(num == 5){
							seq_c = 0;
							loadRations();
							$('.frame-interact').find('.response').html("");
							$('.frame-interact').hide();
							$('.frame-rations').show();
						} else if(num == 6){
							$('.frame-interact').find('#rest').show();
							seq_c = 1;
						} else if(num == 8 && !caravan.fort){
							fish = caravan.goFishing();
							$('.frame-interact').find('.response').html("");
							$('.frame-interact').find('#alert').html(
								"You caught " + fish + " pounds of fish."
							);
							$('.frame-interact').find('#alert').show();
							loadInteract(weather);
							seq_c = 3;
						} else if(num == 9){
							seq_c = 0;
							loadStore();
							$('.frame-interact').find('.response').html("");
							$('.frame-interact').hide();
							$('.frame-store').show();
						}
					}
				}
				//Handle interactions on the hall of fame page.
				else if(activeFrame == "frame frame-hall"){
					if(key_code==32){
						$('.frame-hall').hide();
						$('.frame-intro').show();
					}
				}
				//Handle interactions on the front page.
				else if(activeFrame == "frame frame-intro"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-intro').find('#in_response').html(event.key);
					}
					else if(key_code == 13){
						var cur = $('.frame-intro').find('#in_response').html();
						if(cur == 1){
							$('.frame-choice').show();
							$('.frame-intro').hide();
						} else if (cur == 2){
							$('.frame-intro').find('#in_response').html(" ");
							$.get( "getTen.php", function(data){
								$('.frame-hall').find('#players').html("");
								$('.frame-hall').find('#scores').html("");
								pairs = data.split("\n");
								for(var i = 0; i < 10; i++){
									player = pairs[i].split(',');
									$('.frame-hall').find('#players').append(player[0] + "<br>");
									$('.frame-hall').find('#scores').append(player[1] + "<br>");
								}
								console.log(pairs);
								$('.frame-hall').show();
								$('.frame-intro').hide();
							});
						}
					}
				}
				//Multi purpose frame for the beginning of the game
				else if(activeFrame == "frame frame-choice"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-choice').find('#choice_res').html(event.key);
					} else if (job != "" && key_code >= 52 && key_code <= 54){
						$('.frame-choice').find('#choice_res').html(event.key);
					}
					else if(key_code == 13 && job == ""){
						var cur = $('.frame-choice').find('#choice_res').html();
						if (cur == 1){
							job = "Banker";
							jobAndTimeSwap();
						} else if (cur == 2){
							job = "Carpenter";
							jobAndTimeSwap();
						} else if (cur == 3){
							job = "Farmer";
							jobAndTimeSwap();
						}
						var cur = $('.frame-choice').find('#choice_res').html(" ");
					} else if(key_code == 13){
						var cur = $('.frame-choice').find('#choice_res').html();
						cara_members = caravan.members;
						if (cur == 1){
							caravan = new Caravan (1,job);
							caravan.members = cara_members;
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 2){
							caravan = new Caravan (31,job);
							caravan.members = cara_members;
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (62,job);
							caravan.members = cara_members;
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (92,job);
							caravan.members = cara_members;
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						} else if (cur == 3){
							caravan = new Caravan (123,job);
							caravan.members = cara_members;
							$('.frame-choice').hide();
							loadStore();
							$('.frame-store').show();
						}
						var cur = $('.frame-choice').find('#choice_res').html(" ");
					}
				}
				//Handle buying things from the store.
				else if (activeFrame == "frame frame-store"){
					if(seq_c == 0 && key_code >= 49 && key_code <= 56){
						$('.frame-store').find('#store-choice').html(event.key);
						seq_c = .5;
					}
					else if(seq_c == .5 && key_code == 13) {
						if($('.frame-store').find('#store-choice').html() == 8){
							if(caravan.fort > 1 || (caravan.fort == 1 && caravan.oxen > 1)){
								seq_c = 0;
								item_being_bought = 0;
								loadInteract(weather);
								$('.frame-store').find('#store-choice').html("");
								$('.frame-store').hide();
								$('.frame-interact').show();
							} else {
								resetCaravan();
								$('.frame-store').find('#store-choice').html("");
								$('.frame-store').find('#store-choice2').html("");
								loadStore();
							}
						} else {
							item_being_bought = $('.frame-store').find('#store-choice').html();
							console.log("Item:", item_being_bought);
							$('.frame-store').find('#s_num').show();
							seq_c = 1;
						}
					} else if ((seq_c == 1 || seq_c == 1.5) && key_code >= 48 && key_code <= 57){
						$('.frame-store').find('#store-choice2').append(event.key);
						seq_c = 1.5;
					} else if (seq_c == 1.5 && key_code == 13){
						buyThings(item_being_bought, $('.frame-store').find('#store-choice2').html());
						$('.frame-store').find('#store-choice').html("");
						$('.frame-store').find('#store-choice2').html("");
						$('.frame-store').find('#s_num').hide();
						loadStore();
						seq_c = 0;
					}
				}
				//Manage naming the party
				else if (activeFrame == "frame frame-names") {
					if(seq_c < 1 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res1').html().length < 30){
							$('.frame-names').find('#names_res1').append(event.key);
							seq_c = .5;
						}
					} else if(seq_c == .5 && key_code == 13){
						seq_c = 1;
					} else 	if(seq_c < 2 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res2').html().length < 30){
							$('.frame-names').find('#names_res2').append(event.key);
							seq_c = 1.5;
						}
					} else if(seq_c == 1.5 && key_code == 13){
						seq_c = 2;
					} else 	if(seq_c < 3 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res3').html().length < 30){
							$('.frame-names').find('#names_res3').append(event.key);
							seq_c = 2.5;
						}
					} else if(seq_c == 2.5 && key_code == 13){
						seq_c = 3;
					} else 	if(seq_c < 4 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res4').html().length < 30){
							$('.frame-names').find('#names_res4').append(event.key);
							seq_c = 3.5;
						}
					} else if(seq_c == 3.5 && key_code == 13){
						seq_c = 4;
					} else if(seq_c < 5 && key_code >= 65 && key_code <=90){
						if($('.frame-names').find('#names_res5').html().length < 30){
							$('.frame-names').find('#names_res5').append(event.key);
							seq_c = 4.5;
						}
					} else if(seq_c == 4.5 && key_code == 13){
						seq_c = 5;
						$('.frame-names').find('#confirm').show();
					} else if(seq_c < 6 && (key_code == 78 || key_code ==89)) {
						seq_c = 5.5;
						$('.frame-names').find('#names_res6').html(event.key);
					} else if(seq_c == 5.5 && key_code == 13){
						if($('.frame-names').find('#names_res6').html().toLowerCase() == "n"){
							$('.frame-names').find('#names_res1').html("");
							$('.frame-names').find('#names_res2').html("");
							$('.frame-names').find('#names_res3').html("");
							$('.frame-names').find('#names_res4').html("");
							$('.frame-names').find('#names_res5').html("");
							$('.frame-names').find('#names_res6').html("");
							seq_c = 0;
							$('.frame-names').find('#confirm').hide();
						} else{
							first = $('.frame-names').find('#names_res1').html();
							caravan.makeMember($('.frame-names').find('#names_res1').html());
							caravan.makeMember($('.frame-names').find('#names_res2').html());
							caravan.makeMember($('.frame-names').find('#names_res3').html());
							caravan.makeMember($('.frame-names').find('#names_res4').html());
							caravan.makeMember($('.frame-names').find('#names_res5').html());
							$('.frame-names').hide();
							$('.frame-choice').show();
							seq_c = 0;
						}
					}
				//Changing pace.
				} else if(activeFrame == "frame frame-pace"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-pace').find('#pace-choice').html(event.key);
						seq_c = 1;
					} else if(seq_c == 1 && key_code == 13){
						seq_c = 0;
						caravan.pace = $('.frame-pace').find('#pace-choice').html()/ 2 + 0.5;
						$('.frame-pace').hide();
						$('.frame-interact').show();
						$('.frame-pace').find('#pace-choice').html("")
					}
				}
				//Changing rations.
				else if(activeFrame == "frame frame-rations"){
					if(key_code >= 49 && key_code <= 51){
						$('.frame-rations').find('#rations-choice').html(event.key);
						seq_c = 1;
					} else if(seq_c == 1 && key_code == 13){
						seq_c = 0;
						caravan.rations = 4 - $('.frame-rations').find('#rations-choice').html();
						$('.frame-rations').hide();
						$('.frame-interact').show();
						$('.frame-rations').find('#rations-choice').html("")
					}
				}
				//Displaying supplies.
				else if(activeFrame == "frame frame-supplies"){
					if(key_code == 32){
						$('.frame-supplies').hide();
						$('.frame-interact').show();
					}
				} else if(activeFrame == "frame frame-river"){
					if($('#description:visible').length && key_code == 32){
						$('#description:visible').hide();
						loadRiverChoice();
					} else if($('#choice_text:visible') && key_code >= 49 && key_code <= 51){
						$('.frame-river').find('#river_res').html(event.key);
						seq_c = 1;
					} else if($('#choice_text:visible') && seq_c == 1 && key_code == 13){
						var response = parseInt($('.frame-river').find('#river_res').html());
						$('.frame-river').find('#river_res').html("");
						seq_c = 0;
						var suc_val = Math.floor(Math.random() * 100);
						if(response == 1){
							if(riverDeep > 3){
								if(suc_val > 75){
									success = true;
								} else{
									success = false;
								}
							} else {
								if(suc_val > 75){
									success = false;
								} else{
									success = true;
								}
							}
							$('#river_header').hide();
							$('#choice_text').hide();
							$('#river').show();
							crossRiver("ford", success);
						} else if (response == 2){
							if(riverDeep > 7){
								if(suc_val > 80){
									success = true;
								} else{
									success = false;
								}
							} else {
								if(suc_val > 80){
									success = false;
								} else{
									success = true;
								}
							}
							$('#river_header').hide();
							$('#choice_text').hide();
							$('#river').show();
							crossRiver("caulk", success);
						} else if (response == 3){
							if(suc_val < 90){
								success = true;
							} else{
								success = false;
							}
							if(caravan.hitLandmark == "Snake River Crossing"){
								if(caravan.clothes >= 2){
									caravan.clothes -= 2;
									$('#river_header').hide();
									$('#choice_text').hide();
									$('#river').show();
									crossRiver("ferry", success);
								}
							} else if (caravan.hitLandmark == "Kansas River Crossing" || caravan.hitLandmark == "Green River"){
								if(caravan.money >= 5){
									caravan.money -= 5;
									$('#river_header').hide();
									$('#choice_text').hide();
									$('#river').show();
									crossRiver("ferry", success);
								}
							}
						}
					} else if('#river:visible' && key_code == 32){
						caravan.hitLandmark = "";
						$('#river').hide();
						clearInterval(travID);
						$('.frame-river').hide();
						$('.frame-travel').show();
						console.log(success);
						if(!success){
							var text = caravan.loseRandom();
							if(text != ""){
								makeEvent(text);
							} else{
								makeEvent("Nothing lost.");
							}
						} else{
							travel();
						}
					}
				} else if(activeFrame == 'frame frame-landmark'){
					if(key_code == 13){
						$('.frame-landmark').hide();
						$('.frame-interact').show();
					}
				} else if(activeFrame == 'frame frame-unimplemented'){
					if(key_code == 13){
						$('.frame-travel').hide();
						$('.frame-interact').hide();
						$('.frame-unimplemented').hide();
						loadEndgame();
						$('.frame-endgame').show();
					}
				} else if(activeFrame == 'frame frame-endgame'){
					if(key_code >= 65 && key_code <= 90){
						$('#endgame_response').append(event.key);
					} else if(key_code == 13){
						//call insert php
						$.post( "insert.php", { name: $('#endgame_response').html(), score: score }, function(data){
								console.log(data);
						});
						
						setTimeout(function(){
							console.log('after');
						},500);

						$.get( "getTen.php", function(data){
							$('.frame-hall').find('#players').html("");
							$('.frame-hall').find('#scores').html("");
							pairs = data.split("\n");
							for(var i = 0; i < 10; i++){
								player = pairs[i].split(',');
								$('.frame-hall').find('#players').append(player[0] + "<br>");
								$('.frame-hall').find('#scores').append(player[1] + "<br>");
							}
						});

						$('.frame-endgame').hide();
						$('.frame-hall').show();
					}
				}
			});
		});
	</script>
	<div class="border"></div>
	<div class="frame frame-travel" style="display: none;">
		<img id="wagon" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<img id="location" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<img id="landmarks" height="0px" width="0px" src="./oregon_trail_sprites/ot_locations.gif"></img>
		<canvas id="myCanvas" width="600" height="190" style="border:0px solid black;"></canvas>
		<p id="info" class="size_up" style="font-family:georgia">
				Press enter to size up the situation.
		</p>
		<div id="data" class="data-frame"><p class="labels" style="font-family:georgia">
				Date :<br>
				Weather :<br>
				Health :<br>
				Food :<br>
				Next landmark :<br>
				Miles traveled :<br>
		</p>
		<p class="data" style="font-family:georgia">
		</p>
		</div>
		<p id="landmark" style="font-family:georgia;display:none;">	
			<p id="landmark_res"></p>
		</p>
		<p id="mpaths_text" style="font-family:georgia;display:none;">	
			<p id="mpaths_res"></p>
		</p>
		<p class="event" style="font-family:georgia;display:none;"></p>
	</div>
	<div class="frame frame-interact" style="font-family:georgia;display:none;">
		<p class="header" style="font-family:georgia">
		Independence<br>
		Date<br>
		</p>
		<p class="status" style="font-family:georgia">
			Weather: getweather<br>
			Health: gethealth<br>
			Pace: getpace<br>
			Rations: getrations<br>
		</p>
		<p class="options" style="font-family:georgia">
			&nbsp;&nbsp;You may: <br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Continue on trail<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Check supplies<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Look at map<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Change pace<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Change food rations<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Stop to rest<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Attempt to trade<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Go fishing<br><br><br>

			&nbsp;&nbsp;What is your choice?
		</p>
		<p class="response" style="font-family:georgia">
		</p>
		<p class="event" style="font-family:georgia;display: none;"></p>
		<div id="alert" style="font-family:georgia;display:none;">
		</div>
		<p id="rest" style="font-family:georgia;display:none;">How many days would you like to rest?
			<p id="rest_res"></p>
		</p>
	</div>
	<div class="frame frame-image" style="display: none;">
	</div>
	<div class="frame frame-choice" style="display: none;">
		<p id="job" style="font-family:georgia">
			Many kinds of people made the trip to Oregon <br><br>

			&nbsp;&nbsp;You may:<br><br>
		
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Be a banker from Boston. <br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Be a carpenter from Ohio. <br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Be a farmer from Illinois.
		</p>
		<p id="choice_choice" style="font-family:georgia">What is your choice?</p>
		<p id="time" style="font-family:georgia;display:none;"> It is 1848. Your jumping off place for Oregon is Independence, Missouri.  You must decide which month to leave Independence. <br>
			<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. March<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. April<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. May<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. June<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. July
		</p>
		<p id="choice_res" style="font-family:georgia"></p>
	</div>
	<div class="frame frame-hall" style="display:none;">
		<p id="columns" style="font-family:georgia"><u>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Scores</u>
		</p>
		<p id="players" style="font-family:georgia">
		</p>
		<p id="scores" style="font-family:georgia">
		</p>
	</div>
	<div class="frame frame-intro" style="">
		<p class="title" style="font-family:georgia">
			The Oregon Trail
		</h1>
		<p id="options" style="font-family:georgia">
			&nbsp;&nbsp;You may:<br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Travel the trail<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. See the top ten<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. New player advice<br>

			<br><br>&nbsp;&nbsp;What is your choice?
		</p>
		<p id="in_response" style="font-family:georgia"></p>
	</div>
	<div class="frame frame-store" style="font-family:georgia;display:none;">
		<p id="items">
		</p>
		<p id="costs">
		</p>
		<p id="fluff">
			per ox<br>
			per set<br>
			per box<br>
			per wheel<br>
			per axle<br>
			per tongue<br>
			per pound<br>
		</p>
		<p id="money">
		</p>
		<p id="store-choice">
		</p>
		<p id="s_num" style="display:none;">
			How many?
		</p>
		<p id="store-choice2">
		</p>
	</div>
	<div class="frame frame-names" style="font-family:georgia;display:none;">
		<p id="question">
		What are the names of the members of your party?
		</p>
		<p id="members">
			&nbsp;1. <br>
			&nbsp;2. <br> 
			&nbsp;3. <br> 
			&nbsp;4. <br> 
			&nbsp;5. <br>
		</p>
		<p id="confirm" style="display:none;">&nbsp;&nbsp;&nbsp;&nbsp;Are these the names you want?</p>
		<p id="names_res1">
		</p>
		<p id="names_res2">
		</p>
		<p id="names_res3">
		</p>
		<p id="names_res4">
		</p>
		<p id="names_res5">
		</p>
		<p id="names_res6">
		</p>
	</div>
	<div class="frame frame-supplies" style="font-family:georgia;display:none;">
		<p id="top">
			Your supplies
		</p>
		<p id="stuff">
			oxen<br>sets of clothing<br>bullets<br>wagon wheels<br>wagon axles<br>wagon tongues<br>pounds of food<br>money left
		</p>
		<p id="quantities">
		</p>
	</div>
	<div class="frame frame-pace" style="font-family:georgia;display:none;">
		<p id="top">
		</p>
		<p id="body">
			The pace at which you travel can change. Your choices are: <br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. a steady pace<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. a strenuous pace<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. a grueling pace<br><br>
			What is your choice?
		</p>
		<p id="pace-choice" > 
		</p>
	</div>
	<div class="frame frame-rations" style="font-family:georgia;display:none;">
		<p id="top">
		</p>
		<p id="body">
			The amount of food that the people in your party eat each day cna change.  The amounts are: <br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. filling - meals are large and generous<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. meager - meals are small and adequate<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. bare bones - meals are small and everyone stays hungry<br><br>
			What is your choice?
		</p>
		<p id="rations-choice" > 
		</p>
	</div>
	<div class="frame frame-river" style="font-family:georgia;display:none;">
		<img id="wagon" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<img id="location" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<!-- The canvas for the panning background -->
		<canvas id="river" height="402px" width="615px" style="display:none;">
				Your browser does not support canvas. Please try again with a different browser.
		</canvas>
		<p id="river_header" style="display:none;"></p>
		<p id="description" style="display:none;"></p>
		<p id="choice_text" style="display:none;"></p>
		<p id="river_res"></p>
	</div>
	<div class="frame frame-landmark" style="font-family:georgia;display:none;">
		<canvas id="places" height="415px" width="615px"></canvas>
	</div>
	<div class="frame frame-unimplemented" style="font-family:georgia;display:none;">
		<p>We did not have time to implement this feature.</p>
	</div>
	<div class="frame frame-endgame" style="font-family:georgia;display:none;">
		<p id="end_items">
		</p>
		<p id="end_data"></p>
		<p id="score"></p>
		<p id="prompt">You may enter your name for the records:</p>
		<p id="endgame_response">ttttt</p>
	</div>
</body>
</html>
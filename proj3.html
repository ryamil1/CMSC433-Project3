<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<script src="./pro3_gui.js"></script>
	<script src="./person.js"></script>	
	<script src="./caravan.js"></script>
	<script src=" https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<link rel="stylesheet" href="interact.css">
</head>
<body>
	<div>
		<img id="wagon" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<img id="location" height="0px" width="0px" src="./oregon_trail_sprites/ot_misc.gif">
		<canvas id="myCanvas" width="600" height="190" style="border:0px solid black;">
	</div>
	<script>
		$('document').ready(function() {
			const OXEN = 20;
			const CLOTHING = 10;
			const PART = 10;
			const AMMO = .40;
			const FOOD = .2;

			var weather = "clear";
			var caravan = new Caravan(1);
			caravan.makeMember("Potato");
			console.log(caravan.members);
			console.log(caravan.day);
			caravan.goFishing();
			console.log(caravan.food);
			caravan.rest(1);
			console.log(caravan.food);
			caravan.rest(2);
			console.log(caravan.food);
			console.log(caravan.members[0].isAlive());
			console.log("Living check", caravan.checkForDead());
			caravan.pace = 2;
			for(var i = 0; i < 100; i++){
				loadInteract(getWeather());
				doStuff(i);
			}

			function doStuff(i){
				setTimeout(function(){
					caravan.getEvent();
					console.log("Rolling along", caravan.distance);
					console.log("Living check", caravan.checkForDead());
					console.log("Next landmark:", caravan.nextLandmark);
					loadInteract(getWeather());
					if(caravan.nextLandmark == "flag1"){
						caravan.goToGreenRiver();
					}
					else if(caravan.nextLandmark == "flag2"){
						caravan.goToTheDalles();
					}
				}, 1000 * (i + 1));
			}

			function getPace(){
				if(caravan.pace == 1){
					return "steady";
				} else if(caravan.pace == 2){
					return "strenuous";
				} else {
					return "grueling";
				}
			}

			function getRations(){
				if(caravan.rations == 3){
					return "filling";
				} else if(caravan.rations == 2){
					return "meager";
				} else{
					return "bare bones";
				}
			}

			function buyThings(item, number){
				var fort_cost = 1;
				var item_cost = 0;
				if(caravan.fort){
					fort_cost += (caravan.fort - 1) / 4; 
				}

				if(item * number * fort_cost > caravan.money){
					return false;
				}

				if(item == 1){
					caravan.oxen += number;
					item_cost = OXEN;
				} else if(item == 2) {
					caravan.clothing += number;
					item_cost = CLOTHING;
				} else if(item == 2) {
					caravan.ammo += number * 20;
					item_cost = AMMO;
				} else if(item == 2) {
					caravan.wheel += number;
					item_cost = PART;
				} else if(item == 2) {
					caravan.tongue += number;
					item_cost = PART;
				} else if(item == 2) {
					caravan.axle += number;
					item_cost = PART;
				} else if(item == 2) {
					caravan.food += number;
					item_cost = FOOD;
				}

				caravan.money -= item_cost * number * fort_cost;
				return true;
			}

			function getDate(){
				if(caravan.day > 273) {
					//game over
				}
				if(caravan.day <= 30){
					return "April " + caravan.day + ", 1848"
				} else if(caravan.day <= 61){
					return "May " + (caravan.day - 30) + ", 1848"
				} else if(caravan.day <= 91){
					return "June " + (caravan.day - 61) + ", 1848"
				} else if(caravan.day <= 122){
					return "July " + (caravan.day - 91) + ", 1848"
				} else if(caravan.day <= 152){
					return "August " + (caravan.day - 122) + ", 1848"
				} else if(caravan.day <= 183){
					return "September " + (caravan.day - 152) + ", 1848"
				} else if(caravan.day <= 213){
					return "October " + (caravan.day - 183) + ", 1848"
				} else if(caravan.day <= 244){
					return "November " + (caravan.day - 213) + ", 1848"
				} else if(caravan.day <= 274){
					return "December " + (caravan.day - 244) + ", 1848"
				}
			}

			function getWeather(){
				value = Math.floor(Math.random() * 100);
				if(this.day < 60 || this.day > 210){
					value -= 10;
				} 
				else if(this.day > 120 && this.day < 180){
					value += 10;
				}

				if(value < 2) {
					return weather = "cold";
				}
				else if(value < 32){
					return weather = "cool";
				}
				else if(value < 46){
					return weather = "rainy";
				}
				else if(value < 49){
					return weather = "very rainy";
				}
				else if(value < 71){
					return weather = "warm";
				}
				else if(value < 97){
					return weather = "hot";
				}
				else{
					return weather = "very hot";
				}
			}

			function loadInteract(weather){
				$('.frame-interact').find('.header').html(
					"<br>" + getDate() + "<br>"
				);

				$('.frame-interact').find('.status').html(
					"&nbsp;&nbsp;Weather: " + weather + "<br>&nbsp;&nbsp;Health: " + caravan.partyHealth() + "<br>&nbsp;&nbsp;Pace: " + getPace() + "<br>&nbsp;&nbsp;Rations: " + getRations() + "<br>"
				);
			}
		});
	</script>
	<script>
			$('document').ready(function() {
				var c = document.getElementById("myCanvas");
				var ctx = c.getContext("2d");
				var ctx2 = c.getContext("2d");
				ctx.fillStyle = "black";
				ctx.fillRect(0, 0, c.width, c.height);
				ctx2.fillStyle = "#25d931";
				ctx2.fillRect(0, 115, c.width, 75);
		
				window.onload = function() {
					var canvas = document.getElementById("myCanvas");
					var ctx = canvas.getContext("2d");
					var img = document.getElementById("wagon");
					var img2 = document.getElementById("location");
					animateScript(2);									// animate the wagon
					ctx.drawImage(img2, 5, 275, 279, 11, 0, 25, 600, 25);			// draw the background
					
					// Example of a moving landmark, This will ideally be called by some other function when
					// approaching a landmark.
					//animateLandmark(2, "River"); 
				};
			});
	</script>
	<div class="frame"></div>
	<div class="frame-interact">
		<p class="header" style="font-family:georgia">
		Independence<br>
		Date<br>
		</p>
		<p class="status" style="font-family:georgia">
			Weather: getweather<br>
			Health: gethealth<br>
			Pace: getpace<br>
			Rations: getrations<br>
		</p>
		<p class="options" style="font-family:georgia">
			&nbsp;&nbsp;You may: <br><br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Continue on trail<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Check supplies<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Look at map<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4. Change pace<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5. Change food rations<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6. Stop to rest<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7. Attempt to trade<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8. Go fishing<br><br><br>

			&nbsp;&nbsp;What is your choice?
		</p>
	</div>
</body>
</html>
